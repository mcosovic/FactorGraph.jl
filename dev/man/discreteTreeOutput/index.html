<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Output Data · FactorGraph</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="FactorGraph logo"/></a><div class="docs-package-name"><span class="docs-autofit">FactorGraph</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Continuous Framework</span><ul><li><a class="tocitem" href="../continuousInput/">Input Data</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">General Factor Graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../continuousModel/">Graphical Model</a></li><li><a class="tocitem" href="../continuousInference/">Inference</a></li><li><a class="tocitem" href="../continuousOutput/">Output Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Tree Factor Graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../continuousTreeModel/">Graphical Model</a></li><li><a class="tocitem" href="../continuousTreeInference/">Inference</a></li><li><a class="tocitem" href="../continuousTreeOutput/">Output Data</a></li></ul></li><li><a class="tocitem" href="../utility/">Utility Functions</a></li></ul></li><li><span class="tocitem">Discrete Framework</span><ul><li><a class="tocitem" href="../discreteInput/">Input Data</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Tree Factor Graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../discreteTreeModel/">Graphical Model</a></li><li><a class="tocitem" href="../discreteTreeInference/">Inference</a></li><li class="is-active"><a class="tocitem" href>Output Data</a></li></ul></li></ul></li><li><span class="tocitem">Theoretical Background</span><ul><li><a class="tocitem" href="../theoreticalInference/">Inference in Factor Graphs</a></li><li><a class="tocitem" href="../theoreticalBelief/">Continuous Variables</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Discrete Framework</a></li><li><a class="is-disabled">Tree Factor Graph</a></li><li class="is-active"><a href>Output Data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Output Data</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mcosovic/FactorGraph.jl/blob/master/docs/src/man/discreteTreeOutput.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="outputTreeDiscrete"><a class="docs-heading-anchor" href="#outputTreeDiscrete">Output Data</a><a id="outputTreeDiscrete-1"></a><a class="docs-heading-anchor-permalink" href="#outputTreeDiscrete" title="Permalink"></a></h1><p>The main inference results are kept in the composite type <code>DiscreteTreeModel</code> in the subtype <code>DiscreteInference</code> with fields:</p><ul><li><code>fromFactor</code>,</li><li><code>toVariable</code></li><li><code>messageFactorVariable</code>,</li><li><code>fromVariable</code></li><li><code>toFactor</code></li><li><code>messageVariableFactor</code>,</li><li><code>marginal</code>.</li></ul><p>The values of messages from factor nodes to variable nodes can be accessed using <code>messageFactorVariable</code> field, while values of messages from variable nodes to factor nodes are stored in <code>messageVariableFactor</code> field. These values correspond to edges defined by factor and variable nodes, with indexes preserved in <code>fromFactor</code> - <code>toVariable</code> and <code>fromVariable</code> - <code>toFactor</code> fields.</p><p>Fields <code>marginal</code> holds state variable normalized marginal distributions.</p><hr/><p>The <code>DiscreteInference</code> field contains the BP algorithm results. To describe the outputs, we will use the example with four random variables, where random variables <span>$\{x_1, x_2, x_3, x_4 \}$</span> have possible states <span>$\{ 4, 3, 1, 2\}$</span>.</p><pre><code class="language-julia-repl">using FactorGraph

probability1 = [1]
table1 = [0.2; 0.3; 0.4; 0.1]

probability2 = [1; 2; 3]
table2 = zeros(4, 3, 1)
table2[1, 1, 1] = 0.2; table2[2, 1, 1] = 0.5; table2[3, 1, 1] = 0.3; table2[4, 1, 1] = 0.0
table2[1, 2, 1] = 0.1; table2[2, 2, 1] = 0.1; table2[3, 2, 1] = 0.7; table2[4, 2, 1] = 0.1
table2[1, 3, 1] = 0.5; table2[2, 3, 1] = 0.2; table2[3, 3, 1] = 0.1; table2[4, 3, 1] = 0.1

probability3 = [4; 2]
table3 = zeros(2, 3)
table3[1, 1] = 0.2; table3[2, 1] = 0.8
table3[1, 2] = 0.5; table3[2, 2] = 0.5
table3[1, 3] = 0.5; table3[2, 3] = 0.5

probability4 = [4]
table4 = [0.4; 0.6]</code></pre><p>The factor graph construction and message initialization is accomplished using <code>discreteTreeModel()</code> function.</p><pre><code class="language-julia-repl">probability = [probability1, probability2, probability3, probability4]
table = [table1, table2, table3, table4]

bp = discreteTreeModel(probability, table)</code></pre><hr/><h4 id="Factor-graph-and-root-variable-node"><a class="docs-heading-anchor" href="#Factor-graph-and-root-variable-node">Factor graph and root variable node</a><a id="Factor-graph-and-root-variable-node-1"></a><a class="docs-heading-anchor-permalink" href="#Factor-graph-and-root-variable-node" title="Permalink"></a></h4><p>The first step in solving/analysing the above system/system of equations is forming a factor graph, where set of variable nodes <span>$\mathcal{X} = \{x_1, x_2, x_3, x_4 \}$</span> is defined by discrete random variables. The set of conditional probability tables denotes the set of factor nodes <span>$\mathcal{F} = \{f_1, f_2, f_3, f_4\}$</span>. Here, we leave the default setting for the root factor, or the function <code>discreteTreeModel()</code> sets the first variable node <span>$x_1$</span> as the root node.</p><img src="../../assets/factorgraphtreediscrete.png" class="center"/>
<figcaption>Figure 1: The tree factor graph with three variable nodes and three factor nodes.</figcaption>
&nbsp;<p>Additionally, we include the virtual factor node <span>$f_{v_1}$</span>, to initiate messages from leaf variable node. The function <code>discreteTreeModel()</code> sets all-ones table of the virtual factor node.</p><hr/><h4 id="Messages-initialization"><a class="docs-heading-anchor" href="#Messages-initialization">Messages initialization</a><a id="Messages-initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Messages-initialization" title="Permalink"></a></h4><p>The initialization step starts with messages from local factor nodes <span>$\{f_1, f_{v_1}, f_4\}$</span> to variable nodes <span>$\mathcal{X}$</span>.</p><hr/><h4 id="Forward-messages-from-the-leaf-nodes-to-the-root-node"><a class="docs-heading-anchor" href="#Forward-messages-from-the-leaf-nodes-to-the-root-node">Forward messages from the leaf nodes to the root node</a><a id="Forward-messages-from-the-leaf-nodes-to-the-root-node-1"></a><a class="docs-heading-anchor-permalink" href="#Forward-messages-from-the-leaf-nodes-to-the-root-node" title="Permalink"></a></h4><p>The BP first forward recursion step starts by computing messages from leaf variable nodes <span>$\{x_3, x_4\}$</span> to the incidence factor nodes <span>$\{f_2, f_3\}$</span>, using incoming messages from factor nodes <span>$\{f_{v_1}, f_4 \}$</span>.</p><pre><code class="language-julia-repl">forwardVariableFactor(bp)

julia&gt; T = bp.inference
julia&gt; [T.fromVariable  T.toFactor  T.messageVariableFactor]
5×3 Matrix{Any}:
 3  2  [1.0]
 4  3  [0.4, 0.6]
 0  0  Float64[]
 0  0  Float64[]
 0  0  Float64[]</code></pre><p>The first row defines the message from variable node <span>$x_3$</span> to factor node <span>$f_2$</span>, the second row keeps the message from variable node <span>$x_4$</span> to factor node <span>$f_3$</span>. The rest of the rows are initialized for messages to be calculated in the next forward and backward steps.</p><p>The second forward recursion step computes the message from factor node <span>$f_3$</span> to the variable node <span>$x_2$</span>, using incoming message from variable node <span>$x_4$</span>.</p><pre><code class="language-julia-repl">forwardFactorVariable(bp)

julia&gt; T = bp.inference
julia&gt; [T.fromFactor T.toVariable T.messageFactorVariable]
5×3 Matrix{Any}:
 3  2  [0.56, 0.5, 0.5]
 0  0  Float64[]
 0  0  Float64[]
 0  0  Float64[]
 0  0  Float64[]</code></pre><p>The first row defines the message from factor node <span>$f_3$</span> to variable node <span>$x_2$</span>. The rest of the rows are initialized for messages to be calculated in the next forward and backward steps.</p><p>The message passing steps from variable nodes to factor nodes and from factor nodes to variable nodes are then applied recursively until messages have been propagated along every link, and the root node has received messages from all of its neighbours. The FactorGraph keeps flag <code>bp.graph.forward</code> to signal that moment. Therefore, a complete forward step can be done using:</p><pre><code class="language-julia-repl">while bp.graph.forward
    forwardVariableFactor(bp)
    forwardFactorVariable(bp)
end</code></pre><hr/><h4 id="Backward-messages-from-the-root-node-to-the-leaf-nodes"><a class="docs-heading-anchor" href="#Backward-messages-from-the-root-node-to-the-leaf-nodes">Backward messages from the root node to the leaf nodes</a><a id="Backward-messages-from-the-root-node-to-the-leaf-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Backward-messages-from-the-root-node-to-the-leaf-nodes" title="Permalink"></a></h4><p>The BP first backward recursion step starts by computing message from the root variable node <span>$x_1$</span> to the factor node <span>$f_2$</span>, using incoming message from factor node <span>$f_1$</span>.</p><pre><code class="language-julia-repl">backwardVariableFactor(bp)

julia&gt; T = bp.inference
julia&gt; [T.fromVariable  T.toFactor  T.messageVariableFactor]
5×3 Matrix{Any}:
 3  2  [1.0]
 4  3  [0.4, 0.6]
 2  2  [0.56, 0.5, 0.5]
 1  2  [0.2, 0.3, 0.4, 0.1]
 0  0  Float64[]</code></pre><p>The first three rows are obtained using forward steps. The fourth row defines the message from variable node <span>$x_1$</span> to factor node <span>$f_2$</span>.</p><p>The secand backward recursion step computes messages from factor node <span>$f_2$</span> to variable nodes <span>$\{x_2, x_3\}$</span>.</p><pre><code class="language-julia-repl">backwardFactorVariable(bp)

julia&gt; T = bp.inference
julia&gt; [T.fromFactor T.toVariable T.messageFactorVariable]
5×3 Matrix{Any}:
 3  2  [0.56, 0.5, 0.5]
 2  1  [0.412, 0.43, 0.568, 0.1]
 2  2  [0.31, 0.34, 0.21]
 2  3  [0.4486]
 0  0  Float64[]</code></pre><p>The first two rows are obtained using forward steps. The third row defines the message from factor node <span>$f_2$</span> to variable node <span>$x_2$</span>, the fourth row keeps the message from factor node <span>$f_2$</span> to variable node <span>$x_3$</span>.</p><p>Thus, the backward recursion starts when the root node received messages from all of its neighbours. It can therefore send out messages to all of its neighbours. These in turn will then have received messages from all of their neighbours and so can send out messages along the links going away from the root, and so on. In this way, messages are passed outwards from the root all the way to the leaves. The FactorGraph keeps flag <code>gbp.graph.backward</code> to signal that moment. Therefore, a complete backward step can be done using:</p><pre><code class="language-julia-repl">while bp.graph.backward
    backwardVariableFactor(bp)
    backwardFactorVariable(bp)
end</code></pre><hr/><h4 id="Marginals"><a class="docs-heading-anchor" href="#Marginals">Marginals</a><a id="Marginals-1"></a><a class="docs-heading-anchor-permalink" href="#Marginals" title="Permalink"></a></h4><p>The normalized marginals of variable nodes <span>$\mathcal{X}$</span> can be obtained using messages from factor nodes <span>$\mathcal{F}$</span> to variable nodes <span>$\mathcal{X}$</span>. Finally, we obtain:</p><pre><code class="language-julia-repl">marginal(bp)

julia&gt; bp.inference.marginal
4-element Vector{Vector{Float64}}:
 [0.18368256798930002, 0.287561301827909, 0.5064645563976816, 0.022291573785109226]
 [0.38698172090949623, 0.37895675434685683, 0.23406152474364691]
 [1.0]
 [0.3004904146232724, 0.6995095853767277]</code></pre><p>Where rows correspond normalized marginal distributions of the state variables <span>$\{x_1, x_2, x_3, x_4 \}$</span>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../discreteTreeInference/">« Inference</a><a class="docs-footer-nextpage" href="../theoreticalInference/">Inference in Factor Graphs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 28 September 2021 12:09">Tuesday 28 September 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
