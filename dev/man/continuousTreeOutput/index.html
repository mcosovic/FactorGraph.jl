<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Output Data · FactorGraph</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="FactorGraph logo"/></a><div class="docs-package-name"><span class="docs-autofit">FactorGraph</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Continuous Framework</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../continuousInput/">Input Data</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">General Factor Graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../continuousModel/">Graphical Model</a></li><li><a class="tocitem" href="../continuousInference/">Inference</a></li><li><a class="tocitem" href="../continuousOutput/">Output Data</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox" checked/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Tree Factor Graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../continuousTreeModel/">Graphical Model</a></li><li><a class="tocitem" href="../continuousTreeInference/">Inference</a></li><li class="is-active"><a class="tocitem" href>Output Data</a></li></ul></li><li><a class="tocitem" href="../utility/">Utility Functions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Discrete Framework</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../discreteInput/">Input Data</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Tree Factor Graph</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../discreteTreeModel/">Graphical Model</a></li><li><a class="tocitem" href="../discreteTreeInference/">Inference</a></li><li><a class="tocitem" href="../discreteTreeOutput/">Output Data</a></li></ul></li></ul></li><li><a class="tocitem" href="../theoretical/">Theoretical Background</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Continuous Framework</a></li><li><a class="is-disabled">Tree Factor Graph</a></li><li class="is-active"><a href>Output Data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Output Data</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mcosovic/FactorGraph.jl/blob/master/docs/src/man/continuousTreeOutput.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="outputTreeContinuous"><a class="docs-heading-anchor" href="#outputTreeContinuous">Output Data</a><a id="outputTreeContinuous-1"></a><a class="docs-heading-anchor-permalink" href="#outputTreeContinuous" title="Permalink"></a></h1><p>The main inference results are kept in the composite type <code>ContinuousTreeModel</code> in the subtype <code>ContinuousInference</code> with fields:</p><ul><li><code>fromFactor</code>,</li><li><code>toVariable</code></li><li><code>meanFactorVariable</code>,</li><li><code>varianceFactorVariable</code>,</li><li><code>fromVariable</code></li><li><code>toFactor</code></li><li><code>meanVariableFactor</code>,</li><li><code>varianceVariableFactor</code>,</li><li><code>mean</code>,</li><li><code>variance</code>.</li></ul><p>The values of messages from factor nodes to variable nodes can be accessed using <code>meanFactorVariable</code> and <code>varianceFactorVariable</code> fields, while values of messages from variable nodes to factor nodes are stored in <code>meanVariableFactor</code> and <code>varianceVariableFactor</code> fields. These values correspond to edges defined by factor and variable nodes, with indexes preserved in <code>fromFactor</code> - <code>toVariable</code> and <code>fromVariable</code> - <code>toFactor</code> fields.</p><p>Fields <code>mean</code> and <code>variance</code> define state variable marginal distributions.</p><hr/><p>The <code>ContinuousInference</code> field contains the GBP algorithm results. To describe the outputs, we will use the example shown below.</p><pre><code class="language-julia-repl">using FactorGraph

#     x1   x2   x3   x4
H = [1.0  0.0  0.0  0.0;  # f1
    -5.0 -4.0  9.0  0.0;  # f2
     2.2  0.0  0.0  0.5;  # f3
     0.0  0.0  1.0  0.0;  # f4
     0.0  0.0  0.0  0.5]  # f5

#     f1   f2   f3   f4   f5
z = [0.0; 1.7; 1.9; 0.8; 2.1]

#       f1   f2   f3   f4   f5
v = [1e-10; 0.1; 0.1; 0.1; 0.1]</code></pre><p>The factor graph construction and message initialization is accomplished using <code>continuousTreeModel()</code> function.</p><pre><code class="language-julia-repl">gbp = continuousTreeModel(H, z, v)</code></pre><hr/><h4 id="Factor-graph-and-root-variable-node"><a class="docs-heading-anchor" href="#Factor-graph-and-root-variable-node">Factor graph and root variable node</a><a id="Factor-graph-and-root-variable-node-1"></a><a class="docs-heading-anchor-permalink" href="#Factor-graph-and-root-variable-node" title="Permalink"></a></h4><p>The first step in solving/analysing the above system/system of equations is forming a factor graph, where set of variable nodes <span>$\mathcal{X} = \{x_1, x_2, x_3, x_4 \}$</span> is defined by state variables. The set of equations denotes the set of factor nodes <span>$\mathcal{F} = \{f_1, f_2, f_3, f_4, f_5\}$</span>.</p><img src="../../assets/factorgraphtree.png" class="center"/>
<figcaption>Figure 1: The tree factor graph with three variable nodes and three factor nodes.</figcaption>
&nbsp;<p>Additionally, we include the virtual factor node <span>$f_{v_1}$</span>, where factor node <span>$f_{v_1}$</span> is singly connected used when the variable node is not directly measured, hence having variance <span>$v_{x_1} \to \infty$</span> or a priori given mean and variance of state variables. Further, the function <code>continuousTreeModel()</code> sets the first variable node <span>$x_1$</span> as the root node.</p><p>To change defualt values of virtual factor nodes and defualt root variable node use:</p><pre><code class="language-julia-repl">gbp = continuousTreeModel(H, z, v; mean = 0.1, variance = 1e60, root = 3)</code></pre><hr/><h4 id="Messages-initialization"><a class="docs-heading-anchor" href="#Messages-initialization">Messages initialization</a><a id="Messages-initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Messages-initialization" title="Permalink"></a></h4><p>The initialization step starts with messages from local factor nodes <span>$\{f_1, f_{v_1}, f_4, f_5 \}$</span> to variable nodes <span>$\mathcal{X}$</span>.</p><hr/><h4 id="Forward-messages-from-the-leaf-nodes-to-the-root-node"><a class="docs-heading-anchor" href="#Forward-messages-from-the-leaf-nodes-to-the-root-node">Forward messages from the leaf nodes to the root node</a><a id="Forward-messages-from-the-leaf-nodes-to-the-root-node-1"></a><a class="docs-heading-anchor-permalink" href="#Forward-messages-from-the-leaf-nodes-to-the-root-node" title="Permalink"></a></h4><p>The GBP first forward recursion step starts by computing messages from leaf variable nodes <span>$\{x_2, x_4\}$</span> to the incidence factor nodes <span>$\{f_2, f_3\}$</span>, using incoming messages from factor nodes <span>$\{f_{v_1}, f_5 \}$</span>.</p><pre><code class="language-julia-repl">forwardVariableFactor(gbp)

julia&gt; T = gbp.inference
julia&gt; [T.fromVariable  T.toFactor  T.meanVariableFactor T.varianceVariableFactor]
5×4 Matrix{Float64}:
 2.0  2.0  0.1  1.0e60
 4.0  3.0  4.2  0.4
 0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0</code></pre><p>The first row defines the message from variable node <span>$x_2$</span> to factor node <span>$f_2$</span>, the second row keeps the message from variable node <span>$x_4$</span> to factor node <span>$f_3$</span>. Zero rows are initialized for messages to be calculated in the next forward and backward steps.</p><p>The second forward recursion step computes the message from factor node <span>$f_3$</span> to the variable node <span>$x_1$</span>, using incoming message from variable node <span>$x_4$</span>.</p><pre><code class="language-julia-repl">forwardFactorVariable(gbp)

julia&gt; T = gbp.inference
julia&gt; [T.fromFactor T.toVariable T.meanFactorVariable T.varianceFactorVariable]
5×4 Matrix{Float64}:
 3.0  1.0  -0.0909091  0.0413223
 0.0  0.0   0.0        0.0
 0.0  0.0   0.0        0.0
 0.0  0.0   0.0        0.0
 0.0  0.0   0.0        0.0</code></pre><p>The first row defines the message from factor node <span>$f_3$</span> to variable node <span>$x_1$</span>. Zero rows are initialized for messages to be calculated in the next forward and backward steps.</p><p>The message passing steps from variable nodes to factor nodes and from factor nodes to variable nodes are then applied recursively until messages have been propagated along every link, and the root node has received messages from all of its neighbours. The FactorGraph keeps flag <code>gbp.graph.forward</code> to signal that moment. Therefore, a complete forward step can be done using:</p><pre><code class="language-julia-repl">while gbp.graph.forward
    forwardVariableFactor(gbp)
    forwardFactorVariable(gbp)
end</code></pre><hr/><h4 id="Backward-messages-from-the-root-node-to-the-leaf-nodes"><a class="docs-heading-anchor" href="#Backward-messages-from-the-root-node-to-the-leaf-nodes">Backward messages from the root node to the leaf nodes</a><a id="Backward-messages-from-the-root-node-to-the-leaf-nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Backward-messages-from-the-root-node-to-the-leaf-nodes" title="Permalink"></a></h4><p>The GBP first backward recursion step starts by computing message from the root variable node <span>$x_3$</span> to the factor node <span>$f_2$</span>, using incoming message from factor node <span>$f_4$</span>.</p><pre><code class="language-julia-repl">backwardVariableFactor(gbp)

julia&gt; T = gbp.inference
julia&gt; [T.fromVariable  T.toFactor  T.meanVariableFactor T.varianceVariableFactor]
5×4 Matrix{Float64}:
 2.0  2.0   0.1      1.0e60
 4.0  3.0   4.2      0.4
 1.0  2.0  -2.2e-10  1.0e-10
 3.0  2.0   0.8      0.1
 0.0  0.0   0.0      0.0</code></pre><p>The first three rows are obtained using forward steps. The fourth row defines the message from variable node <span>$x_3$</span> to factor node <span>$f_2$</span>.</p><p>The secand backward recursion step computes messages from factor node <span>$f_2$</span> to variable nodes <span>$\{x_1, x_2\}$</span>.</p><pre><code class="language-julia-repl">backwardFactorVariable(gbp)

julia&gt; T = gbp.inference
julia&gt; [T.fromFactor T.toVariable T.meanFactorVariable T.varianceFactorVariable]
5×4 Matrix{Float64}:
 3.0  1.0  -0.0909091  0.0413223
 2.0  3.0   0.233333   1.97531e59
 2.0  1.0   1.02       6.4e59
 2.0  2.0   1.375      0.5125
 0.0  0.0   0.0        0.0</code></pre><p>The first two rows are obtained using forward steps. The third row defines the message from factor node <span>$f_2$</span> to variable node <span>$x_1$</span>, the fourth row keeps the message from factor node <span>$f_2$</span> to variable node <span>$x_2$</span>.</p><p>Thus, the backward recursion starts when the root node received messages from all of its neighbours. It can therefore send out messages to all of its neighbours. These in turn will then have received messages from all of their neighbours and so can send out messages along the links going away from the root, and so on. In this way, messages are passed outwards from the root all the way to the leaves. The FactorGraph keeps flag <code>gbp.graph.backward</code> to signal that moment. Therefore, a complete backward step can be done using:</p><pre><code class="language-julia-repl">while gbp.graph.backward
    backwardVariableFactor(gbp)
    backwardFactorVariable(gbp)
end</code></pre><hr/><h4 id="Marginals"><a class="docs-heading-anchor" href="#Marginals">Marginals</a><a id="Marginals-1"></a><a class="docs-heading-anchor-permalink" href="#Marginals" title="Permalink"></a></h4><p>The marginal of variable nodes <span>$\mathcal{X}$</span> can be obtained using messages from factor nodes <span>$\mathcal{F}$</span> to variable nodes <span>$\mathcal{X}$</span>. Note that the mean value of marginal is adopted as the estimated value of the state variable. Finally, we obtain:</p><pre><code class="language-julia-repl">marginal(gbp)

julia&gt; [gbp.inference.mean gbp.inference.variance]
3×2 Matrix{Float64}:
 -2.2e-10  1.0e-10
  1.375    0.5125
  0.8      0.1
  4.0      0.2</code></pre><p>Where rows correspond with mean and variance values of the state variables <span>$\{x_1, x_2, x_3, x_4 \}$</span>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../continuousTreeInference/">« Inference</a><a class="docs-footer-nextpage" href="../utility/">Utility Functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 22 September 2021 16:12">Wednesday 22 September 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
